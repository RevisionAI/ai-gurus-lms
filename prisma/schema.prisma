generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model announcements {
  id        String    @id
  title     String
  content   String
  createdAt DateTime  @default(now())
  courseId  String
  authorId  String
  deletedAt DateTime?
  users     users     @relation(fields: [authorId], references: [id])
  courses   courses   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([deletedAt])
}

model assignments {
  id          String        @id
  title       String
  description String?
  dueDate     DateTime?
  maxPoints   Int           @default(100)
  isPublished Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  courseId    String
  createdById String
  deletedAt   DateTime?
  moduleId    String?
  courses     courses       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users       users         @relation(fields: [createdById], references: [id])
  modules     modules?      @relation(fields: [moduleId], references: [id], onDelete: SetNull)
  grades      grades[]
  submissions submissions[]

  @@index([deletedAt])
  @@index([moduleId])
}

model course_content {
  id             String      @id
  title          String
  type           ContentType
  content        String?
  fileUrl        String?
  thumbnailUrl   String?
  orderIndex     Int
  isPublished    Boolean     @default(false)
  createdAt      DateTime    @default(now())
  courseId       String
  s3Key          String?
  thumbnailS3Key String?
  deletedAt      DateTime?
  moduleId       String?
  courses        courses     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  modules        modules?    @relation(fields: [moduleId], references: [id], onDelete: SetNull)

  @@index([deletedAt])
  @@index([moduleId])
}

model courses {
  id                 String           @id
  title              String
  description        String?
  code               String           @unique
  semester           String
  year               Int
  isActive           Boolean          @default(true)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  instructorId       String
  deletedAt          DateTime?
  learningObjectives String[]
  prerequisites      String?
  targetAudience     String?
  announcements      announcements[]
  assignments        assignments[]
  course_content     course_content[]
  users              users            @relation(fields: [instructorId], references: [id])
  discussions        discussions[]
  enrollments        enrollments[]
  modules            modules[]

  @@index([deletedAt])
}

model discussion_posts {
  id                     String             @id
  content                String
  parentId               String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime
  discussionId           String
  authorId               String
  users                  users              @relation(fields: [authorId], references: [id])
  discussions            discussions        @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  discussion_posts       discussion_posts?  @relation("discussion_postsTodiscussion_posts", fields: [parentId], references: [id])
  other_discussion_posts discussion_posts[] @relation("discussion_postsTodiscussion_posts")
}

model discussions {
  id               String             @id
  title            String
  description      String?
  isPinned         Boolean            @default(false)
  isLocked         Boolean            @default(false)
  createdAt        DateTime           @default(now())
  courseId         String
  createdBy        String
  deletedAt        DateTime?
  moduleId         String?
  discussion_posts discussion_posts[]
  courses          courses            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users            users              @relation(fields: [createdBy], references: [id])
  modules          modules?           @relation(fields: [moduleId], references: [id], onDelete: SetNull)

  @@index([deletedAt])
  @@index([moduleId])
}

model enrollments {
  id         String   @id
  enrolledAt DateTime @default(now())
  userId     String
  courseId   String
  courses    courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [userId], references: [id])

  @@unique([userId, courseId])
}

model feedback_templates {
  id           String   @id
  name         String
  category     String
  template     String
  instructorId String
  isShared     Boolean  @default(false)
  usageCount   Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([instructorId])
}

model grades {
  id                             String      @id
  points                         Float
  feedback                       String?
  gradedAt                       DateTime    @default(now())
  assignmentId                   String
  studentId                      String
  gradedById                     String
  deletedAt                      DateTime?
  assignments                    assignments @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  users_grades_gradedByIdTousers users       @relation("grades_gradedByIdTousers", fields: [gradedById], references: [id])
  users_grades_studentIdTousers  users       @relation("grades_studentIdTousers", fields: [studentId], references: [id])

  @@unique([assignmentId, studentId])
  @@index([deletedAt])
}

model module_progress {
  id            String    @id
  completedAt   DateTime?
  contentViewed String[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  moduleId      String
  userId        String
  deletedAt     DateTime?
  modules       modules   @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  users         users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([moduleId, userId])
  @@index([deletedAt])
  @@index([moduleId])
  @@index([userId])
}

model modules {
  id               String            @id
  title            String
  description      String?
  orderIndex       Int
  isPublished      Boolean           @default(false)
  requiresPrevious Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  deletedAt        DateTime?
  courseId         String
  assignments      assignments[]
  course_content   course_content[]
  discussions      discussions[]
  module_progress  module_progress[]
  courses          courses           @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([deletedAt])
}

model submissions {
  id           String      @id
  content      String?
  fileUrl      String?
  submittedAt  DateTime    @default(now())
  assignmentId String
  studentId    String
  s3Key        String?
  assignments  assignments @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  users        users       @relation(fields: [studentId], references: [id])

  @@unique([assignmentId, studentId])
}

model users {
  id                              String               @id
  email                           String               @unique
  name                            String
  surname                         String
  password                        String
  cellNumber                      String
  company                         String
  position                        String
  workAddress                     String
  role                            UserRole             @default(STUDENT)
  createdAt                       DateTime             @default(now())
  updatedAt                       DateTime
  deletedAt                       DateTime?
  announcements                   announcements[]
  assignments                     assignments[]
  courses                         courses[]
  discussion_posts                discussion_posts[]
  discussions                     discussions[]
  enrollments                     enrollments[]
  feedback_templates              feedback_templates[]
  grades_grades_gradedByIdTousers grades[]             @relation("grades_gradedByIdTousers")
  grades_grades_studentIdTousers  grades[]             @relation("grades_studentIdTousers")
  module_progress                 module_progress[]
  submissions                     submissions[]

  @@index([deletedAt])
}

enum ContentType {
  TEXT
  VIDEO
  DOCUMENT
  LINK
  SCORM
  YOUTUBE
}

enum UserRole {
  STUDENT
  INSTRUCTOR
  ADMIN
}
